<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows Merge</title>
    <style>
        body { margin: 0; overflow: hidden; }
        #gameCanvas { border: 1px solid black; }
        #shop { position: fixed; top: 10px; right: 10px; }
        #frames { 
            position: fixed; 
            bottom: 10px; 
            left: 50%; 
            transform: translateX(-50%); 
            display: flex; 
            flex-wrap: wrap; 
            width: 780px; 
            justify-content: center; 
        }
        .frame { 
            border: 1px solid gray; 
            width: 60px; 
            height: 60px; 
            margin: 5px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
        }
        .frame img { max-width: 100%; max-height: 100%; }
        button { margin: 5px; }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div id="shop">
        <h3>Shop</h3>
        <button id="buyWin">Winくんを購入（価格: <span id="price">100</span> コイン）</button>
        <button id="mergeWin">マージ</button>
        <button id="deleteWin">Winくん削除</button>
        <button id="resetGame">リセット</button>
        <div id="coins">コイン: 0</div>
        <div id="availableWins">利用可能: 0</div>
    </div>
    <div id="frames">
        <!-- 12個の枠をHTML内で静的に定義 -->
        <div class="frame" id="frame0" onclick="showWinKunInfo(0)"></div>
        <div class="frame" id="frame1" onclick="showWinKunInfo(1)"></div>
        <div class="frame" id="frame2" onclick="showWinKunInfo(2)"></div>
        <div class="frame" id="frame3" onclick="showWinKunInfo(3)"></div>
        <div class="frame" id="frame4" onclick="showWinKunInfo(4)"></div>
        <div class="frame" id="frame5" onclick="showWinKunInfo(5)"></div>
        <div class="frame" id="frame6" onclick="showWinKunInfo(6)"></div>
        <div class="frame" id="frame7" onclick="showWinKunInfo(7)"></div>
        <div class="frame" id="frame8" onclick="showWinKunInfo(8)"></div>
        <div class="frame" id="frame9" onclick="showWinKunInfo(9)"></div>
        <div class="frame" id="frame10" onclick="showWinKunInfo(10)"></div>
        <div class="frame" id="frame11" onclick="showWinKunInfo(11)"></div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let coins = parseInt(localStorage.getItem('coins')) || 0;
        let frames = JSON.parse(localStorage.getItem('frames')) || Array.from({ length: 12 }).map(() => null);
        let winPrice = parseInt(localStorage.getItem('winPrice')) || 100;
        let winKunsTextures = ['1.0', '2.0', '3.0', '3.1', '95', '98', 'me', '2000', 'xp', 'longhorn', 'vista', '7', '8', '8.1', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21'];
        let winKunsPower = {
            '1.0': 10, '2.0': 20, '3.0': 30, '3.1': 40, '95': 50, 
            '98': 60, 'me': 70, '2000': 80, 'xp': 90, 'longhorn': 100, 
            'vista': 110, '7': 120, '8': 130, '8.1': 140, '10': 150, 
            '11': 160, '12': 170, '13': 180, '14': 190, '15': 200,
            '16': 220, '17': 240, '18': 260, '19': 280, '20': 310,
            '21': 340
        };
        let winSize = 60;
        let spawnInterval = 3000; // 3 seconds for spawning Winくん
        let coinGenerationInterval = 10000; // 10 seconds for general coin generation

        function drawFrames() {
            frames.forEach((winK, index) => {
                const frame = document.getElementById(`frame${index}`);
                if (winK) {
                    const img = new Image();
                    img.src = winK.texture;
                    img.onload = () => {
                        frame.innerHTML = ''; // Clear previous image
                        frame.appendChild(img);
                    };
                } else {
                    frame.innerHTML = ''; // Clear frame if empty
                }
            });
        }

        function spawnWinKun() {
            const texture = winKunsTextures[Math.floor(Math.random() * winKunsTextures.length)];
            const image = new Image();
            image.src = `images/${texture}.png`;
            image.onload = () => {
                const power = winKunsPower[texture] || 10;

                // Find an empty frame to place the new winKun
                const emptyIndex = frames.indexOf(null);
                if (emptyIndex !== -1) {
                    frames[emptyIndex] = {
                        x: Math.random() * (canvas.width - winSize),
                        y: Math.random() * (canvas.height - winSize),
                        image: image,
                        power: power,
                        texture: `images/${texture}.png`
                    };
                    localStorage.setItem('frames', JSON.stringify(frames));
                    drawFrames();
                }
            };
        }

        function buyWinKun() {
            if (coins >= winPrice) {
                coins -= winPrice;
                winPrice += 50; // Increase price for the next purchase
                localStorage.setItem('coins', coins);
                localStorage.setItem('winPrice', winPrice);
                document.getElementById('price').innerText = winPrice;
                updateShop();
            }
        }

        function updateShop() {
            // Randomly update available wins in the shop (for demonstration purposes)
            const randomTexture = winKunsTextures[Math.floor(Math.random() * winKunsTextures.length)];
            document.getElementById('availableWins').innerText = `利用可能: ${randomTexture}`;
        }

        function showWinKunInfo(frameIndex) {
            const winK = frames[frameIndex];
            if (winK) {
                alert(`Frame ${frameIndex}: ${winK.texture} (Power: ${winK.power})`);
            } else {
                alert(`Frame ${frameIndex} is empty`);
            }
        }

        function mergeWinKuns(frameIndex1, frameIndex2) {
            const winK1 = frames[frameIndex1];
            const winK2 = frames[frameIndex2];

            if (winK1 && winK2) {
                alert(`マージする Winくん の情報:\nFrame ${frameIndex1}: ${winK1.texture} (Power: ${winK1.power})\nFrame ${frameIndex2}: ${winK2.texture} (Power: ${winK2.power})`);

                if (winK1.texture === winK2.texture) {
                    const textureIndex = winKunsTextures.indexOf(winK1.texture.split('/').pop().split('.')[0]);
                    const nextIndex = textureIndex + 1;

                    if (nextIndex < winKunsTextures.length) {
                        const newTexture = winKunsTextures[nextIndex];
                        const newImage = new Image();
                        newImage.src = `images/${newTexture}.png`;

                        newImage.onload = () => {
                            frames[frameIndex1] = {
                                x: (winK1.x + winK2.x) / 2,
                                y: (winK1.y + winK2.y) / 2,
                                image: newImage,
                                power: winK1.power + winK2.power,
                                texture: `images/${newTexture}.png`
                            };
                            frames[frameIndex2] = null;
                            localStorage.setItem('frames', JSON.stringify(frames));
                            drawFrames();
                        };
                    } else {
                        alert('これ以上アップグレードできません。');
                    }
                } else {
                    alert('選択されたWinくんはマージできません。');
                }
            } else {
                alert('選択されたWinくんが存在しません。');
            }
        }

        function deleteWinKun(frameIndex) {
            frames[frameIndex] = null;
            localStorage.setItem('frames', JSON.stringify(frames));
            drawFrames();
        }

        function resetGame() {
            if (confirm('本当にゲームをリセットしますか？')) {
                coins = 0;
                winPrice = 100;
                frames = Array.from({ length: 12 }).map(() => null);
                localStorage.setItem('coins', coins);
                localStorage.setItem('winPrice', winPrice);
                localStorage.setItem('frames', JSON.stringify(frames));
                drawFrames();
                updateShop();
            }
        }

        document.getElementById('buyWin').addEventListener('click', buyWinKun);
        document.getElementById('mergeWin').addEventListener('click', () => {
            const frameIndex1 = parseInt(prompt('マージする Winくん のFrame Index 1を入力してください (0-11):'));
            const frameIndex2 = parseInt(prompt('マージする Winくん のFrame Index 2を入力してください (0-11):'));
            if (!isNaN(frameIndex1) && !isNaN(frameIndex2) && frameIndex1 >= 0 && frameIndex1 < 12 && frameIndex2 >= 0 && frameIndex2 < 12) {
                mergeWinKuns(frameIndex1, frameIndex2);
            } else {
                alert('無効なフレームインデックスです。');
            }
        });
        document.getElementById('deleteWin').addEventListener('click', () => {
            const frameIndex = parseInt(prompt('削除する Winくん のFrame Indexを入力してください (0-11):'));
            if (!isNaN(frameIndex) && frameIndex >= 0 && frameIndex < 12) {
                deleteWinKun(frameIndex);
            } else {
                alert('無効なフレームインデックスです。');
            }
        });
        document.getElementById('resetGame').addEventListener('click', resetGame);

        setInterval(spawnWinKun, spawnInterval);
        setInterval(() => {
            coins += 10;
            localStorage.setItem('coins', coins);
            document.getElementById('coins').innerText = `コイン: ${coins}`;
        }, coinGenerationInterval);

        drawFrames();
        updateShop();
    </script>
</body>
</html>
